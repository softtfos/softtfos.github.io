$(document).ready(function(){$("#menu-item-2").addClass("menu-active"),$("#myTable").DataTable(),$("#datepickerFrom").datepicker({format:"dd.mm.yyyy",autoclose:!0}),$("#datepickerTo").datepicker({format:"dd.mm.yyyy",autoclose:!0}),$("#datepickerPair").datepair(),localStorage.length&&($("#datepickerFrom").val(localStorage.getItem("dateFrom")),$("#datepickerTo").val(localStorage.getItem("dateTo")))});var tableTemplate='<table id="myTable" class="table" cellspacing="0" width="100%"><thead><tr><th>Number</th><th>Status</th><th>StatusCode</th><th>DatePayedKeeping</th><th>OrderId</th><th>Cost</th></tr></thead><tbody></tbody></table>';function sendAjax(e,t,a){$.ajax({url:"https://api.novaposhta.ua/v2.0/json/",dataType:"json",type:"post",data:JSON.stringify({apiKey:a,modelName:"InternetDocument",calledMethod:"getDocumentList",methodProperties:{DateTimeFrom:e,DateTimeTo:t,GetFullList:"1",UnassembledCargo:"1"}}),success:function(e,t){console.log("getDocumentsList array "+e.data.length);sendTtnAjax(prepareTtn(e.data))}})}var flags=[];function sendTtnAjax(e){var t,a=[];for(t=0;t<e.length;t++)flags.push(!0),$.ajax({url:"https://api.novaposhta.ua/v2.0/json/",dataType:"json",type:"post",data:JSON.stringify({modelName:"TrackingDocument",calledMethod:"getStatusDocuments",methodProperties:{Documents:e[t]}}),success:function(e,t){if(a.push(e.data),flags.splice(0,1),!flags.length){for(var o=[],r=0;r<a.length;r++)o=o.concat(a[r]);var l={},d=o.filter(function(e){return e.Number in l?0:l[e.Number]=1});console.log("Filtered array "+d.length),drawTable(d)}}})}function prepareTtn(e){var t,a=localStorage.getItem("phoneNumber"),o=0,r=100,l=[];for(l.push([]),t=0;t<e.length;t++)t>=r&&(o++,r+=100,l.push([])),l[o].push({DocumentNumber:e[t].IntDocNumber,Phone:a});return l}function drawTable(e){$("#tableWrapper").empty(),$("#tableWrapper").append(tableTemplate);var t,a="";for(t=0;t<e.length;t++)a+="<tr><td>"+e[t].Number+"</td><td>"+e[t].Status+"</td><td>"+e[t].StatusCode+"</td><td>"+e[t].DatePayedKeeping+"</td><td>"+e[t].ClientBarcode+"</td><td>"+e[t].AnnouncedPrice+"</td></tr>";$("tbody").append(a),$("#myTable").DataTable()}$("#checkBtn").click(function(){var e=$("#datepickerFrom").val(),t=$("#datepickerTo").val(),a=localStorage.getItem("apiKey");localStorage.getItem("phoneNumber");localStorage.length?(localStorage.getItem("dateFrom")!==e&&localStorage.setItem("dateFrom",e),localStorage.getItem("dateTo")!==t&&localStorage.setItem("dateTo",t)):(localStorage.setItem("dateFrom",e),localStorage.setItem("dateTo",t)),sendAjax(e,t,a)}),$("#clearBtn").click(function(){$("#datepickerFrom").val(""),$("#datepickerTo").val(""),localStorage.removeItem("dateFrom"),localStorage.removeItem("dateTo")});