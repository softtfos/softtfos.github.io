window.BuildingData={tables:{options:{multiTtnPage:{columnDefs:[{targets:"_all",defaultContent:"-"}],columns:[{title:"Number",data:"Number"},{title:"Status",data:"Status",width:"45%"},{title:"DatePayedKeeping",data:"DatePayedKeeping",render:function(t){return(t=t.split(" "))[0]}},{title:"Weight (kg)",data:"DocumentWeight"},{title:"Cost",data:"DocumentCost"}],rowCallback:function(t,e){var a="",n=parseInt(e.StatusCode);7===n||8===n?a="wait":n>=9&&n<=11?a="done":6===n&&(a="soon"),$(t).addClass(a)}},paymentPage:{columnDefs:[{targets:-1,data:"LastCreatedOnTheBasisDocumentType",render:function(t){return"CargoReturn"===t?"Y":""}},{targets:"_all",defaultContent:"-"}],columns:[{title:"Number",data:"Number"},{title:"Status",data:"Status",width:"35%"},{title:"Weight (kg)",data:"DocumentWeight",weight:"5%"},{title:"DatePayedKeeping",data:"DatePayedKeeping",render:function(t){return(t=t.split(" "))[0]}},{title:"OrderId",data:"ClientBarcode"},{title:"Cost",data:"AnnouncedPrice"},{title:"Return",data:"LastCreatedOnTheBasisDocumentType",width:"5%"}]},returnPage:{columnDefs:[{targets:"_all",defaultContent:"-"}],columns:[{title:"Number",data:"Number"},{title:"Status",data:"Status",width:"35%"},{title:"DatePayedKeeping",data:"DatePayedKeeping",render:function(t){return(t=t.split(" "))[0]}},{title:"InitialDocNumber",data:"InitialDocumentNumber"},{title:"Price",data:"AnnouncedPrice"},{title:"Penalty",data:"Cost"}]}}}};
!function(){var t="dateFrom",e="apiKeyArr",o={from:{set:function(e){localStorage.setItem(t,e)},get:function(){return localStorage.getItem(t)},remove:function(){localStorage.removeItem(t)}},to:{set:function(t){localStorage.setItem("dateTo",t)},get:function(){return localStorage.getItem("dateTo")},remove:function(){localStorage.removeItem("dateTo")}}},n={get:function(){return JSON.parse(localStorage.getItem(e))},set:function(t){localStorage.setItem(e,JSON.stringify(t))},remove:function(){localStorage.removeItem(e)}},r={get:function(){return localStorage.getItem("ttnList")},set:function(t){localStorage.setItem("ttnList",t)}};window.ClientStorage={updateTimeRange:function(t,e){o.from.get()!==t&&o.from.set(t),o.to.get()!==e&&o.to.set(e)},updateTtnList:function(t){r.get()!==t&&r.set(t)},getTtnList:function(){return r.get()},getTimeRange:function(){return{from:o.from.get(),to:o.to.get()}},removeTimeRange:function(){o.from.remove(),o.to.remove()},getAccounts:function(){return n.get()},initAccount:function(){n.set([])},setAccount:function(t,e){var o=n.get();o.push({apiKey:t,phoneNumber:e}),n.set(o)},removeAccount:function(t){var e=n.get();e.splice(t,1),n.set(e)},removeAccounts:function(){n.remove()}}}();
var progressBar={update:function(r,t){var a=r+ +$(".progress .progress-bar").attr("aria-valuenow");$(".progress .progress-bar").css("width",a+"%").attr("aria-valuenow",a),$(".progress .val").text(a+"%"),$(".description").text(t)},clear:function(){$(".progress .progress-bar").css("width","0%").attr("aria-valuenow",0),$(".progress .val").text("0%"),$(".description").text("Loading")},calculatePercentage:function(r,t){if(r<t||t<=0)throw new Error("Error! Percent should be >= portion and portion > 0");for(var a=Math.round(r/t),e=a*t-r,o=[],s=0;s<t-1;s++)o.push(a);return e>0||e<0?o.push(a-e):o.push(a),o}};
$(document).ready(function(){$("#menu-item-5").addClass("menu-active");var e={format:"dd.mm.yyyy",autoclose:!0,defaultDateDelta:null};$("#datepickerFrom").datepicker(e),$("#datepickerTo").datepicker(e),$("#datepickerPair").datepair();var t=ClientStorage.getTimeRange();$("#datepickerFrom").val(t.from),$("#datepickerTo").val(t.to)});function getDocumentsData(e,t){resultTtnArr=[];var r=ClientStorage.getAccounts();flags.push(!0);sendAjax(1,r[0].apiKey,e,t)}var flags=[],resultTtnArr=[];function sendAjax(e,t,r,a){$.ajax({url:"https://api.novaposhta.ua/v2.0/json/",dataType:"json",type:"post",data:JSON.stringify({apiKey:t,modelName:"InternetDocument",calledMethod:"getDocumentList",methodProperties:{DateTimeFrom:r,DateTimeTo:a,Page:e,GetFullList:"0"}}),success:function(n,o){if(flags.splice(0,1),!flags.length)if(resultTtnArr=resultTtnArr.concat(n.data),console.log(n.info.totalCount+"--"+resultTtnArr.length),+n.info.totalCount>resultTtnArr.length)$("#statResult").text(resultTtnArr.length+" from "+ +n.info.totalCount),sendAjax(++e,t,r,a);else{var l=grabStatistics(resultTtnArr);$("#statResult").text("All items - "+resultTtnArr.length+", money returned - "+l.moneyReturned+" UAH, delivered - "+l.delivered+", money payed for delivery - "+l.payedMoneyForDelivery+" UAH, return percentage - "+l.returnPercentage+"%")}}})}function grabStatistics(e){for(var t={moneyReturned:0,delivered:0,payedMoneyForDelivery:0,returnPercentage:0},r=0;r<e.length;r++){var a=e[r].BackwardDeliveryMoney,n=e[r].StateId,o=+e[r].CostOnSite;a>0&&(t.moneyReturned+=e[r].BackwardDeliveryMoney),n>=9&&n<=11&&t.delivered++,"Sender"===e[r].PayerType&&(t.payedMoneyForDelivery+=o),t.returnPercentage=(100-t.delivered/e.length*100).toFixed(2)}return t}$("#checkBtn").click(function(){var e=$("#datepickerFrom").val(),t=$("#datepickerTo").val();ClientStorage.updateTimeRange(e,t),getDocumentsData(e,t)}),$("#clearBtn").click(function(){$("#datepickerFrom").val(""),$("#datepickerTo").val(""),ClientStorage.removeTimeRange()});